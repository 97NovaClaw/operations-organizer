---
description: 
globs: 
alwaysApply: false
---
## ğŸ§± Project Architecture Rules for WordPress Development (Cursor AI)

This project is built in WordPress and must follow a modular, scalable, and clean architecture. Follow these rules at all times.

---

### ğŸ“ Folder & File Structure

- All code must be grouped by **feature/domain**, not by file type.
- Features go inside a `features/` folder.
- Each feature must have its own subfolder and an `index.php` entry point.

Example:

```
features/
â”œâ”€â”€ kanban/
â”‚ â”œâ”€â”€ index.php
â”‚ â”œâ”€â”€ ajax.php
â”‚ â”œâ”€â”€ validators.php
â”‚ â””â”€â”€ form-handler.php
â”œâ”€â”€ job-logs/
â”‚ â”œâ”€â”€ index.php
â”‚ â”œâ”€â”€ schema.php
â”‚ â””â”€â”€ form-handler.php
```

- Do **not** place unrelated logic into the same file. Split by responsibility:
  - `index.php` â€“ high-level controller/loader
  - `ajax.php` â€“ for AJAX endpoints
  - `validators.php` â€“ validation rules
  - `form-handler.php` â€“ data submission handling
  - `schema.php` â€“ structure/field definitions

---

### ğŸ“œ Feature Trees (Required)

- Each feature folder **must include a "Feature Tree" comment** inside `index.php`.
- This is a **single comment block** that outlines the folder's structure and purpose.
- Do **not** include feature trees in other files or for individual functions.

âœ… Example of a Feature Tree:

```php
/*
Feature Tree: Job Logs

job-logs/
â”œâ”€â”€ index.php          # Entry point
â”œâ”€â”€ schema.php         # Defines fields
â”œâ”€â”€ form-handler.php   # Handles submission
â”œâ”€â”€ validators.php     # Logic validation
*/
```
Update this tree if new files are added.

### ğŸ§© File Responsibility
Each file must serve one purpose. Never mix responsibilities.

Inside long files, break up logic with comment section headers like:

```php
// ===== Form Validation =====
// ===== AJAX Endpoints =====
// ===== UI Render Helpers =====
```
If a file exceeds ~1500 lines, split it into logical parts using this structure:

- `ajax.php`
- `form-handler.php`
- `validators.php`
- `schema.php`
- etc.

### ğŸ“¦ JavaScript & Assets
JS must be organized per feature inside:

```
assets/js/features/{feature-name}/
```
âœ… Example:

```
assets/js/features/kanban/
â”œâ”€â”€ main.js
â”œâ”€â”€ events.js
â”œâ”€â”€ validation.js
```
Mirror PHP structure where practical.

Scripts must be enqueued using `wp_enqueue_script()` in the correct context (admin or frontend).

---

### âš™ï¸ Cursor AI Behavior
- Always follow the modular feature folder structure above.
- If a feature grows, break it down by logical concerns, not line count alone.
- Use the Feature Tree in each module to understand its structure.
- Never place new functions in a file unless the file is explicitly responsible for that logic.
- Update Feature Trees when creating or splitting files.

âœ… Summary Rules
1. One feature = one folder
2. One responsibility = one file
3. One feature tree = one `index.php`
4. Never mix unrelated logic

5. Update trees and structure as features grow 

---

### ğŸŒ³ Current Project Structure

```
.
â”‚   .gitignore
â”‚   operations-organizer.php
â”‚   ... (other root files)
â”‚
â”œâ”€â”€â”€.cursor
â”‚   â””â”€â”€â”€rules
â”‚           airules.mdc
â”‚
â”œâ”€â”€â”€admin
â”‚   â”œâ”€â”€â”€css
â”‚   â”‚       admin-styles.css
â”‚   â”œâ”€â”€â”€js
â”‚   â”‚       admin-scripts.js
â”‚   â””â”€â”€â”€views
â”‚       â”‚   dashboard-page.php
â”‚       â”‚   employee-management-page.php
â”‚       â”‚   job-management-page.php
â”‚       â”‚   kpi-measure-management-page.php
â”‚       â”‚   phase-management-page.php
â”‚       â”‚   start-job-form-page.php
â”‚       â”‚   stop-job-form-page.php
â”‚       â”‚   stream-management-page.php
â”‚       â”‚
â”‚       â”œâ”€â”€â”€dashboard-tabs
â”‚       â”‚       art-tab.php
â”‚       â”‚       content-tab.php
â”‚       â”‚       electronics-tab.php
â”‚       â”‚       overview-tab.php
â”‚       â”‚       soft-content-tab.php
â”‚       â”‚
â”‚       â””â”€â”€â”€stream-pages
â”‚               single-stream-page-template.php
â”‚
â”œâ”€â”€â”€features
â”‚   â””â”€â”€â”€stream-dashboard (New, empty)
â”‚
â”œâ”€â”€â”€includes
â”‚       class-oo-admin-pages.php
â”‚       class-oo-building.php
â”‚       class-oo-dashboard.php
â”‚       class-oo-db.php
â”‚       class-oo-derived-kpi.php
â”‚       class-oo-employee.php
â”‚       class-oo-expense-type.php
â”‚       class-oo-expense.php
â”‚       class-oo-job-log.php
â”‚       class-oo-job-stream.php
â”‚       class-oo-job.php
â”‚       class-oo-kpi-measure.php
â”‚       class-oo-phase.php
â”‚       class-oo-stream.php
â”‚       functions.php
â”‚
â””â”€â”€â”€languages
        .gitkeep

---

### ğŸ›ï¸ High-Level Architecture Summary (Discovered)

This summary reflects the state of the codebase as of the start of the refactoring process.

-   **Primary Entry Points:**
    -   `operations-organizer.php`: Main plugin file. Includes all core `class-oo-*.php` files and registers all AJAX actions globally.
    -   `class-oo-admin-pages.php`: Acts as a router, creating the admin menu items and deciding which view file to load.

-   **Core Architectural Patterns:**
    -   **Model-View-Controller Hybrids:** Most entities (e.g., `OO_Employee`, `OO_Job`, `OO_Phase`) have a single class in `includes/` that acts as both the data model and the controller for its corresponding `admin/views/*-management-page.php` file.
    -   **Pure AJAX Controllers:** KPI-related logic (e.g., `OO_KPI_Measure`, `OO_Derived_KPI`) is handled by stateless classes containing only AJAX handler methods.
    -   **Pure Data Models:** Some entities (e.g., `OO_Job_Log`, `OO_Job_Stream`) are represented by pure data model classes with no controller or view logic.
    -   **Monolithic Database Class:** All classes depend on the static `OO_DB` class for all database interactions.
    -   **Global Helpers:** `functions.php` provides globally available helper functions.
    -   **Global JavaScript:** `admin/js/admin-scripts.js` contains a large amount of shared front-end logic that is loaded on most admin pages.

-   **Active vs. Deprecated Views:**
    -   **Deprecated (Do Not Modify):** The **Global Dashboard**, rendered by `admin/views/dashboard-page.php` and its sub-views in `admin/views/dashboard-tabs/`, is considered obsolete.
    -   **Active (Primary Refactor Target):** The **Stream Dashboards** (e.g., "Soft Content", "Electronics") are the current, active feature. They are all rendered by the single template file: `admin/views/stream-pages/single-stream-page-template.php`. Our refactoring work will focus exclusively on this file and its dependencies.





``` 